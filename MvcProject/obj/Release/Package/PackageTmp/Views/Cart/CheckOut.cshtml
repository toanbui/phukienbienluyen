@model Entities.Param.FrontEnd.CheckOutModel
@using Utilities;
@using Entities;
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="flexbox">
<head>
    <link rel="shortcut icon" href="//theme.hstatic.net/1000282280/1000362500/14/favicon.png?v=1537" type="image/png" />
    <title>
        Phụ kiện hoàng gia - Thanh toán đơn hàng
    </title>
    <meta name="description" content="Nh&#224; thuốc Suplo - Chuỗi nh&#224; thuốc t&#226;y lớn nhất Việt Nam - Thanh to&#225;n đơn h&#224;ng" />
    <link href='~/Content/checkouts.css' rel='stylesheet' type='text/css' media='all' />
    <script src='~/Scripts/jquery.min.js' type='text/javascript'></script>
    <script src='~/Scripts/jquery.validate.js' type='text/javascript'></script>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2, user-scalable=no">
    <style>
        .error {
            display: block;
            color: red;
        }
    </style>
</head>
<body>
    <div class="banner">
        <div class="wrap">
            <a href="/" class="logo">
                <h1 class="logo-text">Phụ kiện hoàng gia - Đặt hàng</h1>
            </a>
        </div>
    </div>
    <button class="order-summary-toggle order-summary-toggle-hide" onclick="toggleCart(this);">
        <div class="wrap">
            <div class="order-summary-toggle-inner">
                <div class="order-summary-toggle-icon-wrapper">
                    <svg width="20" height="19" xmlns="http://www.w3.org/2000/svg" class="order-summary-toggle-icon"><path d="M17.178 13.088H5.453c-.454 0-.91-.364-.91-.818L3.727 1.818H0V0h4.544c.455 0 .91.364.91.818l.09 1.272h13.45c.274 0 .547.09.73.364.18.182.27.454.18.727l-1.817 9.18c-.09.455-.455.728-.91.728zM6.27 11.27h10.09l1.454-7.362H5.634l.637 7.362zm.092 7.715c1.004 0 1.818-.813 1.818-1.817s-.814-1.818-1.818-1.818-1.818.814-1.818 1.818.814 1.817 1.818 1.817zm9.18 0c1.004 0 1.817-.813 1.817-1.817s-.814-1.818-1.818-1.818-1.818.814-1.818 1.818.814 1.817 1.818 1.817z"></path></svg>
                </div>
                <div class="order-summary-toggle-text order-summary-toggle-text-show">
                    <span>Hiển thị thông tin đơn hàng</span>
                    <svg width="11" height="6" xmlns="http://www.w3.org/2000/svg" class="order-summary-toggle-dropdown" fill="#000"><path d="M.504 1.813l4.358 3.845.496.438.496-.438 4.642-4.096L9.504.438 4.862 4.534h.992L1.496.69.504 1.812z"></path></svg>
                </div>
                <div class="order-summary-toggle-text order-summary-toggle-text-hide">
                    <span>Ẩn thông tin đơn hàng</span>
                    <svg width="11" height="7" xmlns="http://www.w3.org/2000/svg" class="order-summary-toggle-dropdown" fill="#000"><path d="M6.138.876L5.642.438l-.496.438L.504 4.972l.992 1.124L6.138 2l-.496.436 3.862 3.408.992-1.122L6.138.876z"></path></svg>
                </div>
                <div class="order-summary-toggle-total-recap">
                    <span class="total-recap-final-price currency-format">@Model.ProductParam.TotalPriceInCart</span>
                </div>
            </div>
        </div>
    </button>
    @if (Model.ProductParam != null && Model.ProductParam.ProductInCarts != null && Model.ProductParam.ProductInCarts.Any())
    {
        using (Html.BeginForm("Create", "Cart", FormMethod.Post, new { @class = "", @data_parsley_type = "", id = "frCheckOut", @role = "form" }))
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(x => x.ProductParam.TotalPriceInCart)
            <div class="content">

                <div class="wrap">
                    <div class="sidebar">
                        <div class="sidebar-content">
                            <div class="order-summary order-summary-is-collapsed">
                                <h2 class="visually-hidden">Thông tin đơn hàng</h2>
                                <div class="order-summary-sections">
                                    <div class="order-summary-section order-summary-section-product-list" data-order-summary-section="line-items">
                                        <table class="product-table">
                                            <thead>
                                                <tr>
                                                    <th scope="col"><span class="visually-hidden">Hình ảnh</span></th>
                                                    <th scope="col"><span class="visually-hidden">Mô tả</span></th>
                                                    <th scope="col"><span class="visually-hidden">Số lượng</span></th>
                                                    <th scope="col"><span class="visually-hidden">Giá</span></th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                                @for (int i = 0; i < Model.ProductParam.ProductInCarts.Count; i++)
                                                {
                                                    var item = Model.ProductParam.ProductInCarts[i];
                                                    @Html.HiddenFor(x => x.ProductParam.ProductInCarts[i].Id)
                                                    @Html.HiddenFor(x => x.ProductParam.ProductInCarts[i].Number)
                                                    @Html.HiddenFor(x => x.ProductParam.ProductInCarts[i].Price)
                                                    @Html.HiddenFor(x => x.ProductParam.ProductInCarts[i].TotalPrice)
                                                    @Html.HiddenFor(x => x.ProductParam.ProductInCarts[i].Avatar)
                                                    @Html.HiddenFor(x => x.ProductParam.ProductInCarts[i].Name)
                                                    @Html.HiddenFor(x => x.ProductParam.ProductInCarts[i].FirstAvatar)
                                                    <tr class="product">
                                                        <td class="product-image">
                                                            <div class="product-thumbnail">
                                                                <div class="product-thumbnail-wrapper">
                                                                    <img class="product-thumbnail-image" alt="@item.Name.EncodeTitle()" src="@item.FirstAvatar.ChangeThumbSize(100,100)" />
                                                                </div>
                                                                <span class="product-thumbnail-quantity" aria-hidden="true">@item.Number</span>
                                                            </div>
                                                        </td>
                                                        <td class="product-description">
                                                            <span class="product-description-name order-summary-emphasis">@item.Name</span>

                                                        </td>
                                                        <td class="product-quantity visually-hidden">@item.Number</td>
                                                        <td class="product-price">
                                                            <span class="order-summary-emphasis currency-format">@item.Price</span>
                                                        </td>
                                                    </tr>
                                                }

                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="">
                                        <table class="total-line-table">
                                            <thead>
                                                <tr>
                                                    <th scope="col"><span class="visually-hidden">Mô tả</span></th>
                                                    <th scope="col"><span class="visually-hidden">Giá</span></th>
                                                </tr>
                                            </thead>
                                            <tfoot class="total-line-table-footer">
                                                <tr class="total-line">
                                                    <td class="total-line-name payment-due-label">
                                                        <span class="payment-due-label-total">Tổng tiền</span>
                                                    </td>
                                                    <td class="total-line-name payment-due">
                                                        <span class="payment-due-currency">VND</span>
                                                        <span class="payment-due-price currency-format" data-checkout-payment-due-target="33500000">
                                                            @Model.ProductParam.TotalPriceInCart
                                                        </span>
                                                    </td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="main">
                        <div class="main-header">
                            <a href="/" class="logo">
                                <h1 class="logo-text">Phụ kiện hoàng gia - Đặt hàng</h1>
                            </a>

                            <ul class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a href="/gio-hang.html">Giỏ hàng</a>
                                </li>

                                <li class="breadcrumb-item breadcrumb-item-current">

                                    Thông tin vận chuyển

                                </li>
                                <li class="breadcrumb-item ">

                                    Phương thức thanh toán

                                </li>

                            </ul>

                        </div>
                        <div class="main-content">

                            <div class="step">
                                <div class="step-sections " step="1">


                                    <div class="section">
                                        <div class="section-header">
                                            <h2 class="section-title">Thông tin đơn hàng</h2>
                                        </div>
                                        <div class="section-content section-customer-information no-mb">

                                            <div class="inventory_location_data">
                                            </div>


                                            <div class="fieldset">


                                                <div class="field   ">
                                                    <div class="field-input-wrapper">
                                                        <label class="field-label" for="billing_address_full_name">Họ và tên</label>
                                                        @Html.TextBoxFor(x => x.CartOrder.Name, new { @Required = "Required", @class = "field-input", @placeholder = "Họ và tên" })
                                                    </div>

                                                </div>



                                                <div class="field  field-two-thirds  ">
                                                    <div class="field-input-wrapper">
                                                        <label class="field-label" for="checkout_user_email">Email</label>
                                                        @Html.TextBoxFor(x => x.CartOrder.Email, new { @Required = "Required", @class = "field-input", @placeholder = "Email" })
                                                    </div>

                                                </div>



                                                <div class="field field-required field-third  ">
                                                    <div class="field-input-wrapper">
                                                        <label class="field-label" for="billing_address_phone">Điện thoại</label>
                                                        @Html.TextBoxFor(x => x.CartOrder.Phone, new { @Required = "Required", @class = "field-input", @placeholder = "Số điện thoại", onkeypress = "return event.charCode >= 48 && event.charCode <= 57" })

                                                    </div>

                                                </div>


                                                <div class="field   ">
                                                    <div class="field-input-wrapper">
                                                        <label class="field-label" for="billing_address_address1">Địa chỉ</label>
                                                        @Html.TextBoxFor(x => x.CartOrder.Address, new { @class = "field-input", @placeholder = "Địa chỉ" })
                                                    </div>

                                                </div>

                                            </div>
                                        </div>
                                        <div class="section-content">
                                            <div class="fieldset">
                                                <div class="field field-show-floating-label  field-half ">
                                                    <div class="field-input-wrapper field-input-wrapper-select">
                                                        <label class="field-label" for="customer_shipping_province"> Tỉnh  </label>

                                                        @*@Html.DropDownListFor(x => x.CartOrder.Province, (Model.ProvinceEntitys as IEnumerable<Entities.Entities.ProvinceEntity>).Select(n => new SelectListItem { Selected = n.Name == Model.CartOrder.Province, Text = n.Name, Value = n.Id.ToString() }), new { @class = "field-input", @placeholder = "" })*@
                                                        <select name="@Html.NameFor(x => x.CartOrder.Province)" id="@Html.IdFor(x => x.CartOrder.Province)" class="field-input">
                                                            @foreach (var province in Model.ProvinceEntitys)
                                                            {
                                                                <option value="@province.Name" data-id="@province.Code">
                                                                    @province.Name
                                                                </option>
                                                            }
                                                        </select>
                                                    </div>

                                                </div>


                                                <div class="field field-show-floating-label  field-half ">
                                                    <div class="field-input-wrapper field-input-wrapper-select">
                                                        <label class="field-label" for="customer_shipping_district">Quận/Huyện</label>
                                                        @Html.DropDownListFor(x => x.CartOrder.District, (Model.DistrictEntitys as IEnumerable<Entities.Entities.DistrictEntity>).Select(n => new SelectListItem { Selected = n.Name == Model.CartOrder.District, Text = n.Name, Value = n.Name }), new { @class = "field-input", @placeholder = "" })
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div id="change_pick_location_or_shipping">


                                        </div>
                                    </div>


                                </div>
                                <div class="step-footer">

                                    <div class="step-footer-continue-btn btn" onclick="CheckOut();">
                                        <span class="btn-content">Đặt hàng</span>
                                        <i class="btn-spinner icon icon-button-spinner"></i>
                                    </div>
                                    <a class="step-footer-previous-link" href="/">
                                        <svg class="previous-link-icon icon-chevron icon" xmlns="http://www.w3.org/2000/svg" width="6.7" height="11.3" viewBox="0 0 6.7 11.3"><path d="M6.7 1.1l-1-1.1-4.6 4.6-1.1 1.1 1.1 1 4.6 4.6 1-1-4.6-4.6z"></path></svg>
                                        Trang chủ
                                    </a>


                                </div>
                            </div>

                        </div>
                        <div class="main-footer">

                        </div>
                    </div>
                </div>

            </div>
        }
    }
    <script>
        $(function () {
            //Validate init
            $.extend($.validator.messages, {
                required: "Trường này bắt buộc có",
            });
            $("#CartOrder_Province").trigger("change");

            //format currency
            $(".currency-format:not('.loaded')").each(function () {
                var number = $(this).html();
                $(this).html(formatCurrency(number)).addClass("loaded");
            });
        });
        $("#CartOrder_Province").on("change", function () {
            var code = $(this).find(':selected').data('id');
            $.ajax({
                url: "/front/Cart/ChangeProvince",
                method: "POST",
                type: "POST",
                data: {
                    code: code
                },
                success: function (res) {
                    if (res.isSuccess) {
                        var temp = [];
                        $.each(res.data, function (i, item) {
                            temp.push("<option value='", item.Name, "'>", item.Type, " ", item.Name, "</option>");
                        });
                        $("#CartOrder_District").html(temp.join(''));
                    }
                }
            });
        });
        function CheckOut() {
            var form = $('form#frCheckOut');

            //validate
            if (!form.valid()) {
                form.validate().focusInvalid();
                return;
            }

            //submit
            jQuery.ajax({
                url: "/front/Cart/CheckOut",
                data: form.serialize(),
                type: "POST",
                success: function (data) {
                    if (data.isSuccess) {
                        alert(data.mess);
                        window.location.reload();
                    } else {
                        alert(data.mess);
                    }
                },
                error: function (jqXhr, errorCode, error) {

                }
            });
        }
        function numberWithCommas(x) {
            x = x.toString();
            var pattern = /(-?\d+)(\d{3})/;
            while (pattern.test(x))
                x = x.replace(pattern, "$1.$2");
            return x;
        }
        function formatCurrency(number) {
            if (number == "") return;
            return numberWithCommas(number) + " ₫";
        }
        function toggleCart(e) {
            if ($(e).hasClass("order-summary-toggle-hide")) {
                $(e).removeClass("order-summary-toggle-hide").addClass("order-summary-toggle-show");
                $(".order-summary").addClass("order-summary-is-expanded").removeClass("order-summary-is-collapsed");
            } else {
                $(e).removeClass("order-summary-toggle-show").addClass("order-summary-toggle-hide");
                $(".order-summary").addClass("order-summary-is-collapsed").removeClass("order-summary-is-expanded");
            }
        }
    </script>
</body>
</html>

